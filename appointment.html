
 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register Your Interest</title>
  <!-- <link rel="stylesheet" href="css/style.css"> -->
   <!-- <link rel="stylesheet" href="css/new.css"> -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <style>
    :root {
      --primary-color: #0077cc;
      --secondary-color: #005fa3;
      --background-color: #280000;
      --text-color: #ffcbb2;
    }

   body {
      background-color: var(--background-color);
      font-family: "Avenir 2", Verdana, sans-serif;
      color: var(--text-color);
      font-size: 1rem;
      line-height: 1.5;
      height: 100vh;
    }

    .section_cta {
      padding-top: 50px;
      opacity: 1;
      background-position: 0 0, 50%;
      background-repeat: repeat, no-repeat;
      background-size: auto, cover;
      position: relative;
      height: 100%;
      min-height: 100vh;
      background-position: center;
      background-size: cover;
    }

.container-large-4 {
  max-width: 800px;
  margin: 0 auto;
}

.heading-style-h3 {
  font-size: 24px;
  margin-bottom: 20px;
  text-align: center;
}

.field_summary {
    display: block;
}

.field-label {
  color: #fff;
    text-align: left;
    letter-spacing: 2px;
    -webkit-text-stroke-color: #041f1b;
    margin-bottom: 5px;
    font-size: 16px;
    font-weight: 300;
}

.text-field {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

/* Radio styled as checkbox */
.options-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.option-item {
  position: relative;
  cursor: pointer;
}

.option-item input[type="radio"] {
  display: none;
}

.option-item label {
  display: inline-block;
  padding: 10px 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.2s;
  background: var(--secondary-color);
}

.option-item input[type="radio"]:checked + label {
   background: var(--primary-color);
  border-color: var(--primary-color);
  color: var(--text-color);
}

.w-button {
  padding: 12px 20px;
   background-color: var(--primary-color);
  color: var(--text-color);
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
}

.w-button:hover {
   background-color: var(--secondary-color);
}

#success_message,
.w-form-fail {
  margin-top: 15px;
  font-size: 14px;
  padding: 10px;
  border-radius: 4px;
}

#success_message {
  background: #e6ffe6;
  color: #2d7a2d;
}

.w-form-fail {
  background: #ffe6e6;
  color: #a33a3a;
}

/* starts new css */

.form-2 {
    grid-column-gap: 30px;
    grid-row-gap: 30px;
    grid-template-rows: auto auto auto auto auto;
    grid-template-columns: 1fr 1fr;
    grid-auto-columns: 1fr;
    display: grid
;
}



.text-field {
    border-style: solid;
    border-width: 0 0 1px;
    border-color: black black var(--color-scheme-1--border);
    color: #fff;
    background-color: #fff0;
    border-radius: 0;
    width: 100%;
    min-width: 100%;
    max-width: 100%;
    min-height: 50px;
    max-height: 200px;
    font-size: 16px;
    font-weight: 400
}

.text-field:focus {
    color: #fff;
    font-size: 14px
}


.text-field:focus-visible,.text-field[data-wf-focus-visible] {
    border-bottom-color: #7da8b2
}

.text-field::placeholder {
    color: #fff;
    font-size: 14px;
    font-weight: 300
}

/* Remove focus border + shadow completely */
.text-field:focus,
.text-field:focus-visible {
  outline: none !important;
  box-shadow: none !important;
  border-color: inherit !important; /* keep same border as normal */
}

/* Remove yellow/blue background from Chrome autofill */
.text-field:-webkit-autofill {
  -webkit-box-shadow: 0 0 0px 1000px #280000 inset !important; /* match your form bg */
  box-shadow: 0 0 0px 1000px #280000 inset !important;
  -webkit-text-fill-color: #fff !important; /* match text color */
  caret-color: #fff !important;             /* cursor stays visible */
}

/* Keep autofill consistent on hover/focus too */
.text-field:-webkit-autofill:focus,
.text-field:-webkit-autofill:hover {
  -webkit-box-shadow: 0 0 0px 1000px #280000 inset !important;
  box-shadow: 0 0 0px 1000px #280000 inset !important;
}


.form-2 .field_div.full-width {
  grid-column: 1 / -1;       /* span across both columns */
  display: block !important; /* behave like normal block */
  width: 100%;               /* ensure full width */
}
    
  </style>
</head>
<body>

  <section id="form" class="section_cta form-section-bg">
    <div class="container-large-4">
      <div class="register-form">
        <div class="cta26_component">
          <div class="max-width-large align-center">
            
            <h2 class="heading-style-h3">
              Register your interest in <span id="project-title"></span>
            </h2>

            <div class="form_block is-form">
              <div class="form-block-2 w-form">

                <form id="register-form" name="register-form" method="post" action="javascript:void(0);" class="form-2" aria-label="Register Form">

                  <!-- First Name -->
                  <div class="field_div">
                    <label for="first_name" class="field-label">First Name*</label>
                    <input class="text-field w-input" maxlength="256" name="first_name" placeholder="First name" type="text" id="first_name" required>
                  </div>

                  <!-- Last Name -->
                  <div class="field_div">
                    <label for="last_name" class="field-label">Last Name*</label>
                    <input class="text-field w-input" maxlength="256" name="last_name" placeholder="Last name" type="text" id="last_name" required>
                  </div>

                  <!-- Email -->
                  <div class="field_div">
                    <label for="email" class="field-label">Email*</label>
                    <input class="text-field w-input" maxlength="256" name="email" placeholder="Enter your email" type="email" id="email" required>
                  </div>

                  <!-- Phone -->
                  <div class="field_div">
                    <label for="phone" class="field-label">Phone Number*</label>
                    <input class="text-field w-input" maxlength="15" name="phone" placeholder="Enter phone number" type="tel" id="phone" required>
                  </div>

                  <div class="field_div full-width">
                    <label class="field-label">Select Date*</label>
                    <div class="options-group" id="date-options">
                      <!-- Dates from API will appear here -->
                    </div>
                  </div>

                  <div class="field_div full-width">
                    <label class="field-label">Time Slot*</label>
                    <div id="slot-options" class="options-group"></div>
                    <div id="slot-message" style="margin-top:10px; color:#a33a3a; font-size:14px; display:none;">
                      All slots booked for this date
                    </div>
                  </div>

                  <!-- Summary Section -->
                  <div class="field_div full-width" style="margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:8px;">
                    <h4>Summary:</h4>
                    <p><strong>Location:</strong> VIP Majlis, Meraas and Nakheel Sales center</p>
                    <p><strong>Date and Time:</strong> <span id="summary-datetime">Not selected</span></p>
                  </div>


                  <!-- Hidden Project Name -->
                  <input type="hidden" id="project-name" name="project_name" value="Solaya">

                  <!-- Success & Fail Messages -->
                  <div id="success_message" style="display:none;">Thank you! Your submission has been received!</div>
                  <div class="w-form-fail" tabindex="-1" role="region" aria-label="Form failure" style="display:none;">
                    <div>Oops! Something went wrong while submitting the form.</div>
                  </div>

                  <!-- Submit Button -->
                  <div class="field_div full-width">
                    <button type="submit" class="w-button">Submit</button>
                  </div>

                </form>

              </div>
            </div>
            
          </div>
        </div>
      </div>  
    </div>
  </section>
  <!-- Success Popup -->
  <div class="modal fade" id="successPopup" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">Booking Successful</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Your appointment has been booked successfully!</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const projectNameInput = document.getElementById("project-name");
  const projectName = projectNameInput.value;
  document.getElementById("project-title").textContent = projectName;

  async function loadSlots() {
    try {
      const projectName = encodeURIComponent(projectNameInput.value);
      const endPointUrl = `https://stage.meraas.com/en/api/appointments/slots?project=${projectName}`;
      console.log("Loading slots from:", endPointUrl);

      const response = await fetch(endPointUrl + "&_ts=" + Date.now(), {
        method: "GET",
      });
      const data = await response.json();
      console.log("Slots response:", data);

      // === Apply API styles dynamically ===
      if (data.font) {
        document.body.style.fontFamily = data.font;
      }
      if (data.primary_color) {
        document.documentElement.style.setProperty("--primary-color", data.primary_color);
      }
      if (data.secondary_color) {
        document.documentElement.style.setProperty("--secondary-color", data.secondary_color);
      }
      if (data.background_color) {
        document.documentElement.style.setProperty("--background-color", data.background_color);
      }
      if (data.text_color) {
        document.documentElement.style.setProperty("--text-color", data.text_color);
      }

      const section = document.querySelector(".section_cta");

      function hexToRgba(hex, alpha = 0.7) {
        let r = 0, g = 0, b = 0;

        // Expand shorthand #abc → #aabbcc
        if (hex.length === 4) {
          hex = "#" + [...hex.slice(1)].map(x => x + x).join("");
        }

        if (hex.length === 7) {
          r = parseInt(hex.slice(1, 3), 16);
          g = parseInt(hex.slice(3, 5), 16);
          b = parseInt(hex.slice(5, 7), 16);
        }

        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      }
      const bgColor = data.background_color || "#280000";
      const secondaryColor = data.secondary_color || bgColor;

      if (data.background_image) {
        section.style.backgroundImage =
          `linear-gradient(${hexToRgba(bgColor)}, ${hexToRgba(secondaryColor)}), url(${data.background_image})`;
        section.style.backgroundSize = "cover";
        section.style.backgroundPosition = "center";
      } else {
        section.style.backgroundImage =
          `linear-gradient(${hexToRgba(bgColor)}, ${hexToRgba(secondaryColor)})`;
      }
      const dateOptions = document.getElementById("date-options");
      const slotOptions = document.getElementById("slot-options");
      const slotMessage = document.getElementById("slot-message");
      const summaryDateTime = document.getElementById("summary-datetime");

      // Clear previous UI
      dateOptions.innerHTML = "";
      slotOptions.innerHTML = "";
      slotMessage.style.display = "none";
      summaryDateTime.textContent = "Not selected";

      let dates = Object.keys(data.dates || {});
      if (dates.length === 0) {
        dateOptions.innerHTML = "<p>No dates available</p>";
        return;
      }

      // Pick first date with available slots, or fallback to first date
      let defaultDate = dates.find(d => data.dates[d].available.length > 0) || dates[0];

      // Render date radio buttons
      dates.forEach((d, index) => {
        const optionId = `date-${index}`;
        dateOptions.insertAdjacentHTML("beforeend", `
          <div class="option-item">
            <input type="radio" id="${optionId}" name="date" value="${d}" ${d === defaultDate ? "checked" : ""}>
            <label for="${optionId}">${d}</label>
          </div>
        `);
      });

      // Attach event listeners after rendering
      dateOptions.querySelectorAll("input[name='date']").forEach(input => {
        input.addEventListener("change", e => renderSlots(e.target.value));
      });

      // Initial slot rendering
      renderSlots(defaultDate);

      function renderSlots(selectedDate) {
        slotOptions.innerHTML = "";
        const available = data.dates[selectedDate].available;

        if (!available || available.length === 0) {
          slotMessage.style.display = "block";
          summaryDateTime.textContent = `${selectedDate} - All slots booked`;
          return;
        }

        slotMessage.style.display = "none";

        // Render available slots
        available.forEach((s, i) => {
          const slotId = `slot-${i}`;
          slotOptions.insertAdjacentHTML("beforeend", `
            <div class="option-item">
              <input type="radio" id="${slotId}" name="slot" value="${s}" ${i===0 ? "checked" : ""}>
              <label for="${slotId}">${s}</label>
            </div>
          `);
        });

        // Update summary with first slot
        updateSummary(selectedDate, available[0]);

        // Add change listeners
        slotOptions.querySelectorAll("input[name='slot']").forEach(input => {
          input.addEventListener("change", e => updateSummary(selectedDate, e.target.value));
        });
      }

      function updateSummary(date, slot) {
        summaryDateTime.textContent = `${date} - ${slot}`;
      }

    } catch (error) {
      console.error("Error fetching slots:", error);
    }
  }

  // Initial load
  loadSlots();

  // Handle form submit
  document.getElementById("register-form").addEventListener("submit", async function (e) {
    e.preventDefault();
    const form = e.target;
    const formData = {
      first_name: form.first_name.value,
      last_name: form.last_name.value,
      email: form.email.value,
      phone: form.phone.value,
      date: form.querySelector("input[name='date']:checked")?.value,
      slot: form.querySelector("input[name='slot']:checked")?.value,
      project_name: form["project-name"].value,
    };
    console.log("Submitting:", formData);

    try {
      const response = await fetch("https://stage.meraas.com/en/api/appointments/book", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      const text = await response.text();
      console.log("Raw booking response:", text);

      let result;
      try {
        result = JSON.parse(text);
      } catch (err) {
        console.error("Failed to parse JSON:", err);
        alert("Server did not return valid JSON. Check console.");
        return;
      }

      if (result.status === "success") {
        let successModal = new bootstrap.Modal(document.getElementById("successPopup"));
        successModal.show();

        form.reset();

        document.getElementById("summary-datetime").textContent = "Not selected";

        loadSlots();

      } else {
        alert(result.message || "Error submitting form");
      }
    } catch (err) {
      console.error("Error submitting form:", err);
      alert("Something went wrong. Please try again later.");
    }
  });
});
</script>



</body>
</html>

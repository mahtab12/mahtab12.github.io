
 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register Your Interest</title>
  <!-- <link rel="stylesheet" href="css/style.css"> -->
   <!-- <link rel="stylesheet" href="css/new.css"> -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <style>

   body {
  background-color: #280000;
    font-family: "Avenir 2", Verdana, sans-serif;;
    color: #ffcbb2;
    font-size: 1rem;
    line-height: 1.5;
}

.section_cta {
  background-color: #280000;
    opacity: 1;
    background-image: linear-gradient(#280000d6,#280000d6),url(https://cdn.prod.website-files.com/680a044466c287311a4266d1/680b5394f1004c07e0c9a171_Asset%2013%403x-80.avif);
    background-position: 0 0,50%;
    background-repeat: repeat,no-repeat;
    background-size: auto,cover;
    position: relative
}

.container-large-4 {
  max-width: 800px;
  margin: 0 auto;
}

.heading-style-h3 {
  font-size: 24px;
  margin-bottom: 20px;
  text-align: center;
}

.field_summary {
    display: block;
}

.field-label {
  color: #fff;
    text-align: left;
    letter-spacing: 2px;
    -webkit-text-stroke-color: #041f1b;
    margin-bottom: 20px;
    font-size: 16px;
    font-weight: 300;
}

.text-field {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

/* Radio styled as checkbox */
.options-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.option-item {
  position: relative;
  cursor: pointer;
}

.option-item input[type="radio"] {
  display: none;
}

.option-item label {
  display: inline-block;
  padding: 10px 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.2s;
  background: #fff;
}

.option-item input[type="radio"]:checked + label {
  background: #0077cc;
  color: #fff;
  border-color: #0077cc;
}

.w-button {
  padding: 12px 20px;
  background-color: #0077cc;
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
}

.w-button:hover {
  background-color: #005fa3;
}

#success_message,
.w-form-fail {
  margin-top: 15px;
  font-size: 14px;
  padding: 10px;
  border-radius: 4px;
}

#success_message {
  background: #e6ffe6;
  color: #2d7a2d;
}

.w-form-fail {
  background: #ffe6e6;
  color: #a33a3a;
}

/* starts new css */

.form-2 {
    grid-column-gap: 30px;
    grid-row-gap: 30px;
    grid-template-rows: auto auto auto auto auto;
    grid-template-columns: 1fr 1fr;
    grid-auto-columns: 1fr;
    display: grid
;
}



.text-field {
    border-style: solid;
    border-width: 0 0 1px;
    border-color: black black var(--color-scheme-1--border);
    color: #fff;
    background-color: #fff0;
    border-radius: 0;
    width: 100%;
    min-width: 100%;
    max-width: 100%;
    min-height: 50px;
    max-height: 200px;
    font-size: 16px;
    font-weight: 400
}

.text-field:focus {
    color: #fff;
    font-size: 14px
}

.text-field:focus-visible,.text-field[data-wf-focus-visible] {
    border-bottom-color: #7da8b2
}

.text-field::placeholder {
    color: #fff;
    font-size: 14px;
    font-weight: 300
}

.form-2 .field_div.full-width {
  grid-column: 1 / -1;       /* span across both columns */
  display: block !important; /* behave like normal block */
  width: 100%;               /* ensure full width */
}
    
  </style>
</head>
<body>

  <section id="form" class="section_cta form-section-bg">
    <div class="container-large-4">
      <div class="register-form">
        <div class="cta26_component">
          <div class="max-width-large align-center">
            
            <h2 class="heading-style-h3">Register your interest</h2>

            <div class="form_block is-form">
              <div class="form-block-2 w-form">

                <form id="register-form" name="register-form" method="post" action="javascript:void(0);" class="form-2" aria-label="Register Form">

                  <!-- First Name -->
                  <div class="field_div">
                    <label for="first_name" class="field-label">First Name*</label>
                    <input class="text-field w-input" maxlength="256" name="first_name" placeholder="First name" type="text" id="first_name" required>
                  </div>

                  <!-- Last Name -->
                  <div class="field_div">
                    <label for="last_name" class="field-label">Last Name*</label>
                    <input class="text-field w-input" maxlength="256" name="last_name" placeholder="Last name" type="text" id="last_name" required>
                  </div>

                  <!-- Email -->
                  <div class="field_div">
                    <label for="email" class="field-label">Email*</label>
                    <input class="text-field w-input" maxlength="256" name="email" placeholder="Enter your email" type="email" id="email" required>
                  </div>

                  <!-- Phone -->
                  <div class="field_div">
                    <label for="phone" class="field-label">Phone Number*</label>
                    <input class="text-field w-input" maxlength="15" name="phone" placeholder="Enter phone number" type="tel" id="phone" required>
                  </div>

                  <div class="field_div full-width">
                    <label class="field-label">Select Date*</label>
                    <div class="options-group" id="date-options">
                      <!-- Dates from API will appear here -->
                    </div>
                  </div>
                  <!-- Date (radio styled like checkbox) -->
                  <!-- <div class="field_div">
                    <label class="field-label">Select Date*</label>
                    <div class="options-group">
                      <div class="option-item">
                        <input type="radio" id="date18" name="date" value="18th Sept" required>
                        <label for="date18">18th Sept</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="date19" name="date" value="19th Sept">
                        <label for="date19">19th Sept</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="date20" name="date" value="20th Sept">
                        <label for="date20">20th Sept</label>
                      </div>
                    </div>
                  </div>
 -->
                  <!-- Time Slot (radio styled like checkbox) -->
                  <!-- <div class="field_div">
                    <label class="field-label">Time Slot*</label>
                    <div class="options-group">
                      <div class="option-item">
                        <input type="radio" id="time10" name="time" value="10:00 AM" required>
                        <label for="time10">10:00 AM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time11" name="time" value="11:00 AM">
                        <label for="time11">11:00 AM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time12" name="time" value="12:00 PM">
                        <label for="time12">12:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time1" name="time" value="1:00 PM">
                        <label for="time1">1:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time2" name="time" value="2:00 PM">
                        <label for="time2">2:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time3" name="time" value="3:00 PM">
                        <label for="time3">3:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time4" name="time" value="4:00 PM">
                        <label for="time4">4:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time5" name="time" value="5:00 PM">
                        <label for="time5">5:00 PM</label>
                      </div>
                    </div>
                  </div> -->

                  <div class="field_div full-width">
                    <label class="field-label">Time Slot*</label>
                    <div id="slot-options" class="options-group"></div>
                    <div id="slot-message" style="margin-top:10px; color:#a33a3a; font-size:14px; display:none;">
                      All slots booked for this date
                    </div>
                  </div>

                  <!-- Summary Section -->
                  <div class="field_div full-width" style="margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:8px;">
                    <h4>Summary:</h4>
                    <p><strong>Location:</strong> VIP Majlis, Meraas and Nakheel Sales center</p>
                    <p><strong>Date and Time:</strong> <span id="summary-datetime">Not selected</span></p>
                  </div>


                  <!-- Hidden Project Name -->
                  <input type="hidden" id="project-name" name="project_name" value="Solaya">

                  <!-- Success & Fail Messages -->
                  <div id="success_message" style="display:none;">Thank you! Your submission has been received!</div>
                  <div class="w-form-fail" tabindex="-1" role="region" aria-label="Form failure" style="display:none;">
                    <div>Oops! Something went wrong while submitting the form.</div>
                  </div>

                  <!-- Submit Button -->
                  <div class="field_div full-width">
                    <button type="submit" class="w-button">Submit</button>
                  </div>

                </form>

              </div>
            </div>
            
          </div>
        </div>
      </div>  
    </div>
  </section>
  <!-- Success Popup -->
  <div class="modal fade" id="successPopup" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">Booking Successful 🎉</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p>Your appointment has been booked successfully!</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-success" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      async function loadSlots() {
      try {
        const projectName = encodeURIComponent(document.getElementById("project-name").value);
        
        const endPointUrl = "https://stage.meraas.com/en/api/appointments/slots?project="+projectName;
        console.log(endPointUrl);
        const response = await fetch(`https://stage.meraas.com/en/api/appointments/slots?project=${projectName}`);
        const data = await response.json();
        console.log(data);

        const dateOptions = document.getElementById("date-options");
        const slotOptions = document.getElementById("slot-options");
        const slotMessage = document.getElementById("slot-message");
        const summaryDateTime = document.getElementById("summary-datetime");

        dateOptions.innerHTML = "";
        slotOptions.innerHTML = "";
        slotMessage.style.display = "none";

        let dates = Object.keys(data.dates);
        let defaultDate = dates.find(d => data.dates[d].available.length > 0) || dates[0];

        // Render date radio buttons
        dates.forEach((d, index) => {
          const optionId = `date-${index}`;
          dateOptions.insertAdjacentHTML("beforeend", `
            <div class="option-item">
              <input type="radio" id="${optionId}" name="date" value="${d}" ${d === defaultDate ? "checked" : ""}>
              <label for="${optionId}">${d}</label>
            </div>
          `);
        });

          renderSlots(defaultDate);

          dateOptions.addEventListener("change", e => renderSlots(e.target.value));

          function renderSlots(selectedDate) {
            slotOptions.innerHTML = "";
              const available = data.dates[selectedDate].available;

              if (available.length === 0) {
                slotMessage.style.display = "block";
                summaryDateTime.textContent = `${selectedDate} - All slots booked`;
                return;
              }

              slotMessage.style.display = "none";

              // Only render available slots
              available.forEach((s, i) => {
                const slotId = `slot-${i}`;
                slotOptions.insertAdjacentHTML("beforeend", `
                  <div class="option-item">
                    <input type="radio" id="${slotId}" name="slot" value="${s}" ${i===0 ? "checked" : ""}>
                    <label for="${slotId}">${s}</label>
                  </div>
                `);
              });

              // Update summary with first available slot
              updateSummary(selectedDate, available[0]);

              slotOptions.querySelectorAll("input").forEach(input => {
                input.addEventListener("change", e => updateSummary(selectedDate, e.target.value));
              });
          }

          function updateSummary(date, slot) {
            summaryDateTime.textContent = `${date} - ${slot}`;
          }

        } catch (error) {
          console.error("Error fetching slots:", error);
        }
      }


      loadSlots();

      document.getElementById("register-form").addEventListener("submit", async function (e) {
        e.preventDefault();
        const form = e.target;
        const formData = {
          first_name: form.first_name.value,
          last_name: form.last_name.value,
          email: form.email.value,
          phone: form.phone.value,
          date: form.querySelector("input[name='date']:checked")?.value,
          slot: form.querySelector("input[name='slot']:checked")?.value,
          project_name: form["project-name"].value, // <- match DB column
        };
        console.log(formData);

        try {
          const response = await fetch("https://stage.meraas.com/en/api/appointments/book", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
          });

          const text = await response.text();  // <-- get raw text
          console.log("Raw response:", text);

          let result;
          try {
            result = JSON.parse(text);  // try parse JSON
          } catch (err) {
            console.error("Failed to parse JSON:", err);
            alert("Server did not return valid JSON. Check console.");
            return;
          }

          if (result.status === "success") {
            let successModal = new bootstrap.Modal(document.getElementById("successPopup"));
            successModal.show();

            // Optional: reload entire page after 2 seconds
            setTimeout(() => {
              window.location.reload();
            }, 6000);
          } else {
            alert(result.message || "Error submitting form");
          }
        } catch (err) {
          console.error("Error submitting form:", err);
          alert("Something went wrong. Please try again later.");
        }

      });
    });
  </script>

</body>
</html>


 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register Your Interest</title>
  <!-- <link rel="stylesheet" href="css/style.css"> -->
   <!-- <link rel="stylesheet" href="css/new.css"> -->
  <style>
   body {
  background-color: #280000;
    font-family: "Avenir 2", Verdana, sans-serif;;
    color: #ffcbb2;
    font-size: 1rem;
    line-height: 1.5;
}

.section_cta {
  background-color: #280000;
    opacity: 1;
    background-image: linear-gradient(#280000d6,#280000d6),url(https://cdn.prod.website-files.com/680a044466c287311a4266d1/680b5394f1004c07e0c9a171_Asset%2013%403x-80.avif);
    background-position: 0 0,50%;
    background-repeat: repeat,no-repeat;
    background-size: auto,cover;
    position: relative
}

.container-large-4 {
  max-width: 800px;
  margin: 0 auto;
}

.heading-style-h3 {
  font-size: 24px;
  margin-bottom: 20px;
  text-align: center;
}

.field_summary {
    display: block;
}

.field-label {
  color: #fff;
    text-align: left;
    letter-spacing: 2px;
    -webkit-text-stroke-color: #041f1b;
    margin-bottom: 20px;
    font-size: 16px;
    font-weight: 300;
}

.text-field {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

/* Radio styled as checkbox */
.options-group {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.option-item {
  position: relative;
  cursor: pointer;
}

.option-item input[type="radio"] {
  display: none;
}

.option-item label {
  display: inline-block;
  padding: 10px 16px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 15px;
  cursor: pointer;
  transition: all 0.2s;
  background: #fff;
}

.option-item input[type="radio"]:checked + label {
  background: #0077cc;
  color: #fff;
  border-color: #0077cc;
}

.w-button {
  padding: 12px 20px;
  background-color: #0077cc;
  color: #fff;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
}

.w-button:hover {
  background-color: #005fa3;
}

#success_message,
.w-form-fail {
  margin-top: 15px;
  font-size: 14px;
  padding: 10px;
  border-radius: 4px;
}

#success_message {
  background: #e6ffe6;
  color: #2d7a2d;
}

.w-form-fail {
  background: #ffe6e6;
  color: #a33a3a;
}

/* starts new css */

.form-2 {
    grid-column-gap: 30px;
    grid-row-gap: 30px;
    grid-template-rows: auto auto auto auto auto;
    grid-template-columns: 1fr 1fr;
    grid-auto-columns: 1fr;
    display: grid
;
}



.text-field {
    border-style: solid;
    border-width: 0 0 1px;
    border-color: black black var(--color-scheme-1--border);
    color: #fff;
    background-color: #fff0;
    border-radius: 0;
    width: 100%;
    min-width: 100%;
    max-width: 100%;
    min-height: 50px;
    max-height: 200px;
    font-size: 16px;
    font-weight: 400
}

.text-field:focus {
    color: #fff;
    font-size: 14px
}

.text-field:focus-visible,.text-field[data-wf-focus-visible] {
    border-bottom-color: #7da8b2
}

.text-field::placeholder {
    color: #fff;
    font-size: 14px;
    font-weight: 300
}

.form-2 .field_div.full-width {
  grid-column: 1 / -1;       /* span across both columns */
  display: block !important; /* behave like normal block */
  width: 100%;               /* ensure full width */
}
    
  </style>
</head>
<body>

  <section id="form" class="section_cta form-section-bg">
    <div class="container-large-4">
      <div class="register-form">
        <div class="cta26_component">
          <div class="max-width-large align-center">
            
            <h2 class="heading-style-h3">Register your interest</h2>

            <div class="form_block is-form">
              <div class="form-block-2 w-form">

                <form id="register-form" name="register-form" method="post" action="javascript:void(0);" class="form-2" aria-label="Register Form">

                  <!-- First Name -->
                  <div class="field_div">
                    <label for="first_name" class="field-label">First Name*</label>
                    <input class="text-field w-input" maxlength="256" name="first_name" placeholder="First name" type="text" id="first_name" required>
                  </div>

                  <!-- Last Name -->
                  <div class="field_div">
                    <label for="last_name" class="field-label">Last Name*</label>
                    <input class="text-field w-input" maxlength="256" name="last_name" placeholder="Last name" type="text" id="last_name" required>
                  </div>

                  <!-- Email -->
                  <div class="field_div">
                    <label for="email" class="field-label">Email*</label>
                    <input class="text-field w-input" maxlength="256" name="email" placeholder="Enter your email" type="email" id="email" required>
                  </div>

                  <!-- Phone -->
                  <div class="field_div">
                    <label for="phone" class="field-label">Phone Number*</label>
                    <input class="text-field w-input" maxlength="15" name="phone" placeholder="Enter phone number" type="tel" id="phone" required>
                  </div>

                  <div class="field_div full-width">
                    <label class="field-label">Select Date*</label>
                    <div class="options-group" id="date-options">
                      <!-- Dates from API will appear here -->
                    </div>
                  </div>
                  <!-- Date (radio styled like checkbox) -->
                  <!-- <div class="field_div">
                    <label class="field-label">Select Date*</label>
                    <div class="options-group">
                      <div class="option-item">
                        <input type="radio" id="date18" name="date" value="18th Sept" required>
                        <label for="date18">18th Sept</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="date19" name="date" value="19th Sept">
                        <label for="date19">19th Sept</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="date20" name="date" value="20th Sept">
                        <label for="date20">20th Sept</label>
                      </div>
                    </div>
                  </div>
 -->
                  <!-- Time Slot (radio styled like checkbox) -->
                  <!-- <div class="field_div">
                    <label class="field-label">Time Slot*</label>
                    <div class="options-group">
                      <div class="option-item">
                        <input type="radio" id="time10" name="time" value="10:00 AM" required>
                        <label for="time10">10:00 AM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time11" name="time" value="11:00 AM">
                        <label for="time11">11:00 AM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time12" name="time" value="12:00 PM">
                        <label for="time12">12:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time1" name="time" value="1:00 PM">
                        <label for="time1">1:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time2" name="time" value="2:00 PM">
                        <label for="time2">2:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time3" name="time" value="3:00 PM">
                        <label for="time3">3:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time4" name="time" value="4:00 PM">
                        <label for="time4">4:00 PM</label>
                      </div>
                      <div class="option-item">
                        <input type="radio" id="time5" name="time" value="5:00 PM">
                        <label for="time5">5:00 PM</label>
                      </div>
                    </div>
                  </div> -->

                  <div class="field_div full-width">
                    <label class="field-label">Time Slot*</label>
                    <div id="slot-options" class="options-group"></div>
                    <div id="slot-message" style="margin-top:10px; color:#a33a3a; font-size:14px; display:none;">
                      All slots booked for this date
                    </div>
                  </div>

                  <!-- Summary Section -->
                  <div class="field_div full-width" style="margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:8px;">
                    <h4>Summary:</h4>
                    <p><strong>Location:</strong> VIP Majlis, Meraas and Nakheel Sales center</p>
                    <p><strong>Date and Time:</strong> <span id="summary-datetime">Not selected</span></p>
                  </div>


                  <!-- Hidden Project Name -->
                  <input type="hidden" id="project-name" name="project-name" value="Emirates Towers Residences">

                  <!-- Success & Fail Messages -->
                  <div id="success_message" style="display:none;">Thank you! Your submission has been received!</div>
                  <div class="w-form-fail" tabindex="-1" role="region" aria-label="Form failure" style="display:none;">
                    <div>Oops! Something went wrong while submitting the form.</div>
                  </div>

                  <!-- Submit Button -->
                  <div class="field_div full-width">
                    <button type="submit" class="w-button">Submit</button>
                  </div>

                </form>

              </div>
            </div>
            
          </div>
        </div>
      </div>  
    </div>
  </section>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      async function loadSlots() {
        try {
          const response = await fetch("https://stage.meraas.com/en/api/appointments/slots");
          const data = await response.json();
          console.log(data);
          const dateOptions = document.getElementById("date-options");
          const slotOptions = document.getElementById("slot-options");
          const slotMessage = document.getElementById("slot-message");
          const summaryDateTime = document.getElementById("summary-datetime");

          dateOptions.innerHTML = "";
          slotOptions.innerHTML = "";
          slotMessage.style.display = "none";

          let dates = Object.keys(data);
          let defaultDate = null;

          // ✅ Pick first date that has slots
          for (let d of dates) {
            if (data[d].available.length > 0) {
              defaultDate = d;
              break;
            }
          }
          // If no available slots at all → fallback to first date
          if (!defaultDate) defaultDate = dates[0];

          // Render date radio buttons
          dates.forEach((d, index) => {
            let optionId = `date-${index}`;
            dateOptions.insertAdjacentHTML("beforeend", `
              <div class="option-item">
                <input type="radio" id="${optionId}" name="date" value="${d}" ${d === defaultDate ? "checked" : ""}>
                <label for="${optionId}">${d}</label>
              </div>
            `);
          });

          // Render slots for default date
          renderSlots(defaultDate);

          // Listen for date change
          dateOptions.addEventListener("change", (e) => {
            renderSlots(e.target.value);
          });

          // Render slots for a date
          function renderSlots(selectedDate) {
            slotOptions.innerHTML = "";
            let slots = data[selectedDate].available;

            if (slots.length === 0) {
              slotMessage.style.display = "block";
              summaryDateTime.textContent = `${selectedDate} - All slots booked`;
              return;
            }

            slotMessage.style.display = "none";
            slots.forEach((s, i) => {
              let slotId = `slot-${i}`;
              slotOptions.insertAdjacentHTML("beforeend", `
                <div class="option-item">
                  <input type="radio" id="${slotId}" name="slot" value="${s}" ${i === 0 ? "checked" : ""}>
                  <label for="${slotId}">${s}</label>
                </div>
              `);
            });

            // ✅ Update summary with first available slot
            updateSummary(selectedDate, slots[0]);

            // Listen for slot change
            slotOptions.querySelectorAll("input").forEach(input => {
              input.addEventListener("change", (e) => {
                updateSummary(selectedDate, e.target.value);
              });
            });
          }

          // Update Summary
          function updateSummary(date, slot) {
            summaryDateTime.textContent = `${date} - ${slot}`;
          }

        } catch (error) {
          console.error("Error fetching slots:", error);
        }
      }

      loadSlots();
      document.getElementById("register-form").addEventListener("submit", async function (e) {
        e.preventDefault();
        const form = e.target;
        const formData = {
          first_name: form.first_name.value,
          last_name: form.last_name.value,
          email: form.email.value,
          phone: form.phone.value,
          date: form.querySelector("input[name='date']:checked")?.value,
          slot: form.querySelector("input[name='slot']:checked")?.value,
          project: form["project-name"].value,
        };

        // console.log(JSON.stringify(formData));

        try {
          const response = await fetch("https://stage.meraas.com/en/api/appointments/book", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
          });

          const result = await response.json();

          if (result.status === "success") {
            document.getElementById("success_message").style.display = "block";
            form.reset();
          } else {
            alert(result.message || "Error submitting form");
          }
        } catch (err) {
          console.error("Error submitting form:", err);
          alert("Something went wrong. Please try again later.");
        }
      });

    });
  
</script>
</body>
</html>
